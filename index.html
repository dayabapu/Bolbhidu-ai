<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Marathi Speakable AI</title>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f0f0f0; }
    video { border: 2px solid #333; border-radius: 8px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Marathi Speakable AI</h1>
  <video id="webcam" autoplay playsinline width="400" height="300"></video>
  <br>
  <button id="flipBtn">Flip Camera</button>
  <h2 id="prediction">Prediction: -</h2>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/qNs3g87f3/"; // <-- Your model link
    let model, webcam, flip = false;

    async function init() {
      model = await tmImage.load(URL + "model.json", URL + "metadata.json");
      webcam = new tmImage.Webcam(400, 300, true); // width, height, flip
      await webcam.setup({ facingMode: "user" });
      await webcam.play();
      document.getElementById("webcam").srcObject = webcam.webcam;
      window.requestAnimationFrame(loop);
    }

    async function loop() {
      webcam.update();
      const prediction = await model.predict(webcam.canvas);
      showPrediction(prediction);
      window.requestAnimationFrame(loop);
    }

    function showPrediction(predictions) {
      let top = predictions[0];
      predictions.forEach(p => {
        if(p.probability > top.probability) top = p;
      });
      document.getElementById("prediction").innerText = `Prediction: ${top.className}`;
      speakMarathi(top.className);
    }

    let lastSpoken = "";
    function speakMarathi(text) {
      if(text === lastSpoken) return; // avoid repeating same prediction constantly
      lastSpoken = text;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'mr-IN';
      speechSynthesis.speak(utter);
    }

    document.getElementById("flipBtn").addEventListener("click", async () => {
      flip = !flip;
      await webcam.stop();
      webcam = new tmImage.Webcam(400, 300, flip);
      await webcam.setup({ facingMode: flip ? "environment" : "user" });
      await webcam.play();
      document.getElementById("webcam").srcObject = webcam.webcam;
    });

    init();
  </script>
</body>
</html>
