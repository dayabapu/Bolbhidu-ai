<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>Bolbhidu-ai Marathi Speakable</title>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.18.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.9/dist/teachablemachine-image.min.js"></script>
</head>
<body>
<h2>Bolbhidu-ai Prediction (Marathi)</h2>
<video id="webcam" width="320" height="240" autoplay playsinline></video><br>
<button id="flipBtn">Flip Camera</button><br>
<h3 id="label">Prediction: </h3>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/qNs3g87f3/"; // replace with your model link if different
let model, webcam, flip = false;

// Load model
async function init() {
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");

    webcam = new tmImage.Webcam(320, 240, true); // width, height, flip
    await webcam.setup(); // request camera permission
    await webcam.play();
    document.getElementById("webcam").srcObject = webcam.webcam.stream;

    requestAnimationFrame(loop);
}
init();

// Flip camera
document.getElementById("flipBtn").addEventListener("click", async () => {
    flip = !flip;
    await webcam.stop();
    webcam = new tmImage.Webcam(320, 240, flip);
    await webcam.setup();
    await webcam.play();
    document.getElementById("webcam").srcObject = webcam.webcam.stream;
});

// Prediction loop
async function loop() {
    webcam.update();
    const prediction = await model.predict(webcam.canvas);
    const top = prediction.sort((a,b)=>b.probability-a.probability)[0];
    document.getElementById("label").innerText = "Prediction: " + top.className;

    // Speak in Marathi
    const utterance = new SpeechSynthesisUtterance(top.className);
    utterance.lang = "mr-IN";
    window.speechSynthesis.cancel(); // stop previous speech
    window.speechSynthesis.speak(utterance);

    requestAnimationFrame(loop);
}
</script>
</body>
</html>
